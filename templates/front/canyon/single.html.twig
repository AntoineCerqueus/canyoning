{% extends 'base.html.twig' %}

{% block title %}H2O Canyon | {{ canyon.name }}{% endblock %}

{% block content %}

<section>
    <h1 class="mb-3">{{ canyon.name }}</h1>

    <div id="carouselExampleIndicators" class="carousel">
        <ol class="carousel-indicators">
            {% for picture in canyon.pictures %}
            <li data-target="#carouselExampleIndicators" data-slide-to="{{ loop.index-1 }}"
                class="{{ loop.first ? 'active': '' }} "></li>
            {% endfor  %}
        </ol>
        <div class="carousel-inner">
            {% for picture in canyon.pictures %}
            <div class="carousel-item {{ loop.first ? 'active': '' }} ">
                <img class="d-block img-fluid" src="{{ asset('assets/uploads/' ~ picture.path)  }}"
                    alt="Image du {{ canyon.name }}">
            </div>
            {% endfor  %}
        </div>
        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
            <span><i class="fas fa-angle-double-left" aria-hidden="true"></i></span>
            <span class="sr-only">Précedente</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
            <span><i class="fas fa-angle-double-right" aria-hidden="true"></i></span>
            <span class="sr-only">Suivante</span>
        </a>
    </div>
    <p class="top">{{ canyon.description }}</p>
</section>
<section>
    <h2>Informations</h2>
    <div class="blur">
        <p>Durée : {{ canyon.duration }}</p>
        <p>Niveau : {{ canyon.level }}</p>
        <p>Age requis : {{ canyon.ageNeeded }}</p>
        <p>Pré-requis : {{ canyon.knowledge }}</p>
        <p>Descente en rappel : {{ canyon.abseiling }}</p>
        <p>Lieu : {{ canyon.location }}</p>
        <p>Départ : {{ canyon.meetingPoint }}</p>
    </div>
</section>
<h2>Prix</h2>
<section>
    <h2>Disponibilités</h2>
    <div id="calendar">
        {# {{ dump(data) }} #}
    </div>

    {% if is_granted('ROLE_USER') %}
    <a href="{{ path('reservation') }}" title="Réservation">
        <div class="nav-button bottom"><i class="fas fa-calendar-day"></i> Réservez</div>
    </a>
    {% else %}
    <div class="text-center mt-5">
        <div>Pour réserver, vous devez vous connecter ! <i class="far fa-smile"></i></div>
        <div>
            <a href="{{ path('app_login')}}" title="Connexion">
                <div class="nav-button"><i class="fas fa-sign-in-alt"></i> connexion</div>
            </a>
        </div>
    </div>
    <div class="text-center mt-5">
        <div>Ou vous inscrire !<i class="far fa-smile"></i></div>
        <div>
            <a href="{{ path('app_register')}}" title="Inscription">
                <div class="nav-button"><i class="fas fa-sign-in-alt"></i> inscription</div>
            </a>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}

{% block javascripts %}

<script>
    // La,nce le script au chargement de la fenêtre
    window.onload = () => {
        // Récupération et instanciation de la div #calendar
        let calendarElt = document.getElementById('calendar');
        // Instanciation d'un objet calendar en lui passant le "calendarElt"
        // en premier paramètre et des options en second
        let calendar = new FullCalendar.Calendar(calendarElt, {
            // Affiche le calendrier en jour par mois
            initialView: 'dayGridWeek',
            // Affiche la date en français
            locale: 'fr',
            // Défini le fuseau horaire
            timeZone: 'Europe/Paris',
            // Positionne les éléments de la barre de navigation
            headerToolbar: {
                left: 'dayGridWeek,dayGridDay,today',
                center: 'title',
                right: 'prev,next'
            },
            // Passe le label des boutons en français
            buttonText: {
                today: 'Aujourd\'hui',
                month: 'Mois',
                week: 'Semaine',
                day: 'Jour'
            },
            // Variable events récupère les données pour les affichées dans le calendrier
            events: {{data|raw}} // filtre twig pour traduire les données en html
        })

        // calendar.setOption('aspectRatio', 1.8);
        // Rends la vue 
        calendar.render();
    };
</script>

{% endblock %}